{% extends 'base.html' %}
{% block head %}
    <title>Cart</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <style>
    main .table-data .todo {
    flex-grow: 1;
    flex-basis: 50px;
    height: 640px;
    color: var(--opposite-color);
    }
    main .table-data .order {
    flex-grow: 1;
    flex-basis: 60%;
    color: var(--opposite-color);
    }
    .separator{
	margin-top: 10px;
    margin-bottom: 10px;
	height: 1px;
	width: 100%;
	background: var(--text-color);
}
    </style>
{% endblock %}
{% block content %}
    <main>
        <div class="head-title">
            <div class="left">
                <h1>Cart</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="{{ url_for('index') }}">Dashboard</a>
                    </li>
                    <li><i class='bx bx-chevron-right'></i></li>
                    <li>
                        <a class="active" href="{{ url_for('cart') }}">Home</a>
                    </li>
                </ul>
            </div>
        </div>

        <ul class="box-info">
                <li>
                    <i class='bx bxs-store'></i>
                    <span class="text">
                <h3>{{ item_count }}</h3>
                <p>Movies in stock</p>
            </span>
                </li>
                <li>
                    <i class='bx bxs-box'></i>
                    <span class="text">
                <h3>{{ owned }}</h3>
                <p>Movies purchased</p>
            </span>
                </li>
                <li>
                    <i class='bx bxs-dollar-circle'></i>
                    <span class="text">
                <h3> {% if not spend %} 0 {% else %}Ksh {{ spend }} {% endif %}</h3>
                <p>Total Spent</p>
            </span>
                </li>
            </ul>


        <div class="table-data">
            <div class="order" >
                <div class="head">
                    <h3>Your Cart</h3>
                </div>
                <p class="separator"></p>

            {% if items %}

                <table>
                    <thead>
                        <tr>
                            <th>Poster</th>
                            <th>Movie Name</th>
                            <th>Trailer</th>
                            <th>Price</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                </table>
                <div class="item-scroll">
                <table>
                    <tbody>
                        {% for item in items %}
                            {% set item_id = item[0] %}
                            <tr>
                                <td>
                                    <img src="{{ item[2] }}" alt="poster" width="100" height="100">
                                </td>
                                <td>
                                    <a href="{{ url_for('item', item_id=item[0]) }}"><p class="scheme">{{ item[1] }}</p></a>
                                </td>
                                <td>
                                    <a href="{{ item[5] }}"><img src="https://www.freepnglogos.com/uploads/youtube-logo-hd-8.png" alt=""></a>
                                </td>
                                <td>
                                    <p class="scheme">{{ item[4] }} Ksh</p>
                                </td>
                                <td>
                                    <form method="POST" action="{{ url_for('remove_from_cart', item_id=item_id) }}">
                                        <button type="submit" class="cart-remove">Remove</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>

                </table>
                </div>

                <br>
                {% else %}
                    <p class="empty">Your cart is empty.</p>
            {% endif %}
            </div>
            <div class="todo">
                <div class="head">
                    <h3>Summary</h3>
                </div>

                {% if items %}
                    <p class="separator"></p>
                    <table>
                    <thead>
                        <tr>
                            <th class="scheme">Movie Name</th>
                            <th class="scheme">Price</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in items %}
                        <tr>
                            <td>
                                <p class="scheme">{{ item[1] }}</p>
                            </td>
                            <td>
                                <p class="scheme">{{ item[4] }}</p>
                            </td>
                        </tr>
                    {% endfor %}
                    <td class="total">Total:</td>
                    <td class="total"> {{ total }}  Ksh</td>

                    </tbody>
                    </table>
                    <form method="POST" action="{{ url_for('checkout') }}" style="margin: 0 auto" class="check-out">
                        <button type="submit" class="check-out-btn"> Checkout</button>
                    </form>
                {% endif %}

            </div>
        </div>
    </main>

{% endblock %}
